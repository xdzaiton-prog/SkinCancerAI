<!DOCTYPE html>
<html>
<head>
  <title>AI Skin Cancer Detector</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #e0f7fa, #ffffff);
      text-align: center;
      padding: 50px;
    }
    h1 { color: #333; }
    #uploadImage, #showButton {
      margin: 10px;
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      background-color: #00796b;
      color: white;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.3s;
    }
    #uploadImage:hover, #showButton:hover { background-color: #004d40; }
    #previewImage { 
      max-width: 300px; 
      margin: 20px auto; 
      border-radius: 12px; 
      border: 2px solid #00796b; 
      display: none; /* hidden until an image is uploaded */
    }
    .progress-bar { width: 80%; margin: 10px auto; background: #eee; border-radius: 10px; overflow: hidden; height: 25px; }
    .progress-fill { height: 100%; color: white; text-align: right; padding-right: 5px; line-height: 25px; width: 0; transition: width 1s; }
    .benign { background: #4caf50; }
    .malignant { background: #f44336; }
    #result { font-weight: bold; margin-top: 20px; font-size: 1.2em; }
  </style>
</head>
<body>

<h1>AI Skin Cancer Detector</h1>
<input type="file" id="uploadImage" accept="image/*"><br>
<img id="previewImage" src=""><br>
<button id="showButton">Show Results</button>

<div id="result">Upload an image to start.</div>

<div class="progress-label">Benign</div>
<div class="progress-bar"><div id="benignBar" class="progress-fill benign">0%</div></div>
<div class="progress-label">Malignant</div>
<div class="progress-bar"><div id="malignantBar" class="progress-fill malignant">0%</div></div>

<script>
const URL = "./"; // model.json, metadata.json, weights.bin are in the same folder
let model, maxPredictions;

async function loadModel() {
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";
    model = await tmImage.load(modelURL, metadataURL);
    maxPredictions = model.getTotalClasses();
    console.log("Model loaded");
}
loadModel();

let uploadedFile = null;
const preview = document.getElementById("previewImage");

document.getElementById("uploadImage").addEventListener("change", function(e){
    uploadedFile = e.target.files[0];
    if (!uploadedFile) return;

    // Show the image immediately
    preview.src = URL.createObjectURL(uploadedFile);
    preview.style.display = "block";

    // Reset results
    document.getElementById("result").innerHTML = "Ready to analyze. Click 'Show Results'.";
    document.getElementById("benignBar").style.width = "0%";
    document.getElementById("benignBar").textContent = "0%";
    document.getElementById("malignantBar").style.width = "0%";
    document.getElementById("malignantBar").textContent = "0%";
});

document.getElementById("showButton").addEventListener("click", async function(){
    if(!uploadedFile) { alert("Please upload an image first"); return; }
    if(!model) { alert("Model still loading. Please wait a moment."); return; }

    // Wait until image fully loads
    await new Promise(r => {
        if (preview.complete) r();
        else preview.onload = r;
    });

    // Run prediction
    const prediction = await model.predict(preview);
    console.log(prediction);

    let benign = 0, malignant = 0;
    prediction.forEach(p => {
        if(p.className.toLowerCase().includes("benign")) benign = p.probability * 100;
        else if(p.className.toLowerCase().includes("malignant")) malignant = p.probability * 100;
    });

    document.getElementById("result").innerHTML = benign > malignant 
      ? "ðŸŸ¢ Likely Benign" 
      : "ðŸ”´ Likely Malignant";

    // Animate progress bars
    const b = document.getElementById("benignBar");
    const m = document.getElementById("malignantBar");
    b.style.width = `${benign.toFixed(1)}%`;
    b.textContent = `${benign.toFixed(1)}%`;
    m.style.width = `${malignant.toFixed(1)}%`;
    m.textContent = `${malignant.toFixed(1)}%`;
});
</script>

</body>
</html>
